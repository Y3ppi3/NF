import { jsx as _jsx, jsxs as _jsxs, Fragment as _Fragment } from "react/jsx-runtime";
import { useState, useEffect } from 'react';
import { Link, useNavigate } from 'react-router-dom';
import { isAuthenticated, isAdmin, logout, getCurrentUser } from '../services/auth';
const Navbar = ({ cartCount = 0 }) => {
    const [isMobileMenuOpen, setIsMobileMenuOpen] = useState(false);
    const [user, setUser] = useState(null);
    const navigate = useNavigate();
    useEffect(() => {
        if (isAuthenticated()) {
            setUser(getCurrentUser());
        }
        else {
            setUser(null);
        }
    }, []);
    const handleLogout = () => {
        logout();
        setUser(null);
        navigate('/');
    };
    return (_jsxs("header", { className: "bg-blue-800 text-white shadow-md", children: [_jsx("div", { className: "max-w-7xl mx-auto px-4 sm:px-6 lg:px-8", children: _jsxs("div", { className: "flex justify-between h-16", children: [_jsxs("div", { className: "flex items-center", children: [_jsx(Link, { to: "/", className: "flex-shrink-0 flex items-center", children: _jsx("span", { className: "text-xl font-bold", children: "\u0421\u0435\u0432\u0435\u0440-\u0420\u044B\u0431\u0430" }) }), _jsxs("nav", { className: "hidden md:ml-8 md:flex md:space-x-8", children: [_jsx(Link, { to: "/products", className: "text-white hover:bg-blue-700 hover:text-white px-3 py-2 rounded-md text-sm font-medium", children: "\u041A\u0430\u0442\u0430\u043B\u043E\u0433" }), isAuthenticated() && (_jsx(Link, { to: "/orders", className: "text-white hover:bg-blue-700 hover:text-white px-3 py-2 rounded-md text-sm font-medium", children: "\u041C\u043E\u0438 \u0437\u0430\u043A\u0430\u0437\u044B" })), isAuthenticated() && isAdmin() && (_jsx(Link, { to: "/admin", className: "text-white hover:bg-blue-700 hover:text-white px-3 py-2 rounded-md text-sm font-medium", children: "\u0410\u0434\u043C\u0438\u043D-\u043F\u0430\u043D\u0435\u043B\u044C" }))] })] }), _jsxs("div", { className: "flex items-center", children: [isAuthenticated() ? (_jsxs("div", { className: "hidden md:flex items-center", children: [_jsxs(Link, { to: "/cart", className: "relative text-white hover:bg-blue-700 px-3 py-2 rounded-md text-sm font-medium", children: ["\u041A\u043E\u0440\u0437\u0438\u043D\u0430", cartCount > 0 && (_jsx("span", { className: "absolute -top-1 -right-1 bg-red-500 text-white text-xs rounded-full h-5 w-5 flex items-center justify-center", children: cartCount > 99 ? '99+' : cartCount }))] }), _jsxs("div", { className: "relative ml-4 group", children: [_jsxs("button", { className: "flex items-center text-sm font-medium text-white hover:bg-blue-700 px-3 py-2 rounded-md", children: [_jsx("span", { children: user?.username || 'Пользователь' }), _jsx("svg", { className: "ml-1 h-4 w-4", fill: "none", stroke: "currentColor", viewBox: "0 0 24 24", xmlns: "http://www.w3.org/2000/svg", children: _jsx("path", { strokeLinecap: "round", strokeLinejoin: "round", strokeWidth: "2", d: "M19 9l-7 7-7-7" }) })] }), _jsxs("div", { className: "absolute right-0 mt-2 w-48 bg-white rounded-md shadow-lg py-1 z-10 hidden group-hover:block", children: [_jsx(Link, { to: "/profile", className: "block px-4 py-2 text-sm text-gray-700 hover:bg-gray-100", children: "\u041C\u043E\u0439 \u043F\u0440\u043E\u0444\u0438\u043B\u044C" }), _jsx(Link, { to: "/orders", className: "block px-4 py-2 text-sm text-gray-700 hover:bg-gray-100", children: "\u041C\u043E\u0438 \u0437\u0430\u043A\u0430\u0437\u044B" }), _jsx("button", { onClick: handleLogout, className: "block w-full text-left px-4 py-2 text-sm text-gray-700 hover:bg-gray-100", children: "\u0412\u044B\u0439\u0442\u0438" })] })] })] })) : (_jsx("div", { className: "hidden md:flex items-center", children: _jsx(Link, { to: "/auth", className: "text-white hover:bg-blue-700 hover:text-white px-3 py-2 rounded-md text-sm font-medium", children: "\u0412\u043E\u0439\u0442\u0438" }) })), _jsxs("div", { className: "flex items-center md:hidden", children: [isAuthenticated() && (_jsxs(Link, { to: "/cart", className: "relative text-white hover:bg-blue-700 px-3 py-2 rounded-md text-sm font-medium", children: [_jsx("svg", { className: "h-6 w-6", fill: "none", stroke: "currentColor", viewBox: "0 0 24 24", xmlns: "http://www.w3.org/2000/svg", children: _jsx("path", { strokeLinecap: "round", strokeLinejoin: "round", strokeWidth: "2", d: "M16 11V7a4 4 0 00-8 0v4M5 9h14l1 12H4L5 9z" }) }), cartCount > 0 && (_jsx("span", { className: "absolute -top-1 -right-1 bg-red-500 text-white text-xs rounded-full h-5 w-5 flex items-center justify-center", children: cartCount > 99 ? '99+' : cartCount }))] })), _jsxs("button", { onClick: () => setIsMobileMenuOpen(!isMobileMenuOpen), className: "ml-2 inline-flex items-center justify-center p-2 rounded-md text-white hover:bg-blue-700 focus:outline-none", children: [_jsx("svg", { className: `h-6 w-6 ${isMobileMenuOpen ? 'hidden' : 'block'}`, fill: "none", stroke: "currentColor", viewBox: "0 0 24 24", xmlns: "http://www.w3.org/2000/svg", children: _jsx("path", { strokeLinecap: "round", strokeLinejoin: "round", strokeWidth: "2", d: "M4 6h16M4 12h16M4 18h16" }) }), _jsx("svg", { className: `h-6 w-6 ${isMobileMenuOpen ? 'block' : 'hidden'}`, fill: "none", stroke: "currentColor", viewBox: "0 0 24 24", xmlns: "http://www.w3.org/2000/svg", children: _jsx("path", { strokeLinecap: "round", strokeLinejoin: "round", strokeWidth: "2", d: "M6 18L18 6M6 6l12 12" }) })] })] })] })] }) }), _jsx("div", { className: `md:hidden ${isMobileMenuOpen ? 'block' : 'hidden'}`, children: _jsxs("div", { className: "px-2 pt-2 pb-3 space-y-1 sm:px-3", children: [_jsx(Link, { to: "/products", className: "text-white hover:bg-blue-700 block px-3 py-2 rounded-md text-base font-medium", onClick: () => setIsMobileMenuOpen(false), children: "\u041A\u0430\u0442\u0430\u043B\u043E\u0433" }), isAuthenticated() && (_jsxs(_Fragment, { children: [_jsx(Link, { to: "/orders", className: "text-white hover:bg-blue-700 block px-3 py-2 rounded-md text-base font-medium", onClick: () => setIsMobileMenuOpen(false), children: "\u041C\u043E\u0438 \u0437\u0430\u043A\u0430\u0437\u044B" }), isAdmin() && (_jsx(Link, { to: "/admin", className: "text-white hover:bg-blue-700 block px-3 py-2 rounded-md text-base font-medium", onClick: () => setIsMobileMenuOpen(false), children: "\u0410\u0434\u043C\u0438\u043D-\u043F\u0430\u043D\u0435\u043B\u044C" })), _jsxs("button", { onClick: () => {
                                        handleLogout();
                                        setIsMobileMenuOpen(false);
                                    }, className: "w-full text-left text-white hover:bg-blue-700 block px-3 py-2 rounded-md text-base font-medium", children: ["\u0412\u044B\u0439\u0442\u0438 (", user?.username || 'Пользователь', ")"] })] })), !isAuthenticated() && (_jsx(Link, { to: "/auth", className: "text-white hover:bg-blue-700 block px-3 py-2 rounded-md text-base font-medium", onClick: () => setIsMobileMenuOpen(false), children: "\u0412\u043E\u0439\u0442\u0438" }))] }) })] }));
};
export default Navbar;
